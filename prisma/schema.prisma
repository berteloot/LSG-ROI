generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model EmployerCostData {
  id              String   @id
  state           String
  category        String
  item            String
  ratePercent     Float    @map("ratePercent")
  employerCostUSD Float    @map("employerCostUSD")
  notes           String?
  source          String?
  createdAt       DateTime @default(now()) @map("createdAt")

  @@unique([state, category, item])
  @@index([category])
  @@index([state])
  @@map("EmployerCostData")
}

model LSGBaseSeat {
  id          String   @id
  delivery    String
  role        String
  monthlyCost Float    @map("monthlyCost")
  notes       String?
  updatedAt   DateTime @map("updatedAt")

  @@unique([delivery, role])
  @@index([delivery])
  @@index([role])
  @@map("LSGBaseSeat")
}

model role_categories {
  category_id   Int      @id @default(autoincrement())
  category_name String   @unique @db.VarChar(100)
  description   String?
  monthly_cost  Decimal? @default(0) @db.Decimal(10, 2)
  roles         roles[]

  @@map("role_categories")
}

model Assessment {
  id         String      @id
  appType    String
  orgId      String
  userId     String
  createdAt  DateTime    @default(now())
  updatedAt  DateTime
  User       User        @relation(fields: [userId], references: [id])
  ROIInputs  ROIInputs?
  ROIResults ROIResults?
}

model FormulaVersion {
  id         String   @id
  appType    String
  version    Int
  configJson Json
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
}

model LSGCalculatorLead {
  id                      String   @id
  email                   String
  companyName             String
  state                   String
  baseSalary              Decimal  @db.Decimal(10, 2)
  fteCount                Int
  roleCategoryKey         Int
  totalEmployerLoad       Decimal  @db.Decimal(10, 2)
  employerExtras          Decimal  @db.Decimal(10, 2)
  inHouseTotalCost        Decimal  @db.Decimal(10, 2)
  lsgCost                 Decimal  @db.Decimal(10, 2)
  annualSavingsPercentage Decimal  @db.Decimal(10, 2)
  inclusions              Json?    // Store cost inclusions as JSON
  roleCategoryName        String?  // Store readable role category name
  costBreakdown           Json?    // Store detailed cost breakdown for email
  emailSent               Boolean  @default(false) // Track if email was sent successfully
  emailSentAt             DateTime? // When email was sent
  createdAt               DateTime @default(now())

  @@index([companyName])
  @@index([createdAt])
  @@index([email])
}

model LSGCostEstimate {
  id        String   @id
  state     String   @unique
  costUSD   Float
  notes     String?
  source    String?
  updatedAt DateTime

  @@index([state])
}

model LSGDiscount {
  id        String   @id
  type      String
  tier      String
  discount  Float
  notes     String?
  updatedAt DateTime

  @@unique([type, tier])
  @@index([tier])
  @@index([type])
}

model LSGMultiplier {
  id         String   @id
  category   String
  value      String
  multiplier Float
  notes      String?
  updatedAt  DateTime

  @@unique([category, value])
  @@index([category])
  @@index([value])
}

model LSGOnboarding {
  id        String   @id
  type      String   @unique
  cost      Float
  notes     String?
  updatedAt DateTime

  @@index([type])
}

model ROIInputs {
  id                        String     @id
  assessmentId              String     @unique
  currency                  String
  periodMonths              Int
  fteCount                  Float
  fullyLoadedCostPerFTE     Float
  annualAttritionRate       Float
  costPerHire               Float
  trainingCostPerHire       Float
  errorRate                 Float
  costPerError              Float
  volumePerMonth            Float
  revenuePerUnit            Float
  fteReductionPct           Float
  attritionReductionPct     Float
  errorReductionPct         Float
  volumeUpliftPct           Float
  oneTimeImplementationCost Float
  monthlySubscriptionCost   Float
  Assessment                Assessment @relation(fields: [assessmentId], references: [id])
}

model ROIResults {
  id              String     @id
  assessmentId    String     @unique
  savingsLabor    Float
  savingsTurnover Float
  savingsQuality  Float
  revenueUplift   Float
  totalSavings    Float
  totalCosts      Float
  netBenefit      Float
  roiPct          Float
  paybackMonths   Float
  npv             Float?
  irr             Float?
  Assessment      Assessment @relation(fields: [assessmentId], references: [id])
}

model StateCostSummary {
  id                    String   @id
  state                 String   @unique
  totalFederalTax       Float
  totalStateTax         Float
  totalHealthcare       Float
  totalRetirement       Float
  totalPaidTimeOff      Float
  totalInsurance        Float
  totalOtherBenefits    Float
  totalAdministrative   Float
  totalITInfrastructure Float
  totalTelecom          Float
  totalEquipment        Float
  totalRealEstate       Float
  totalWorkforceMgmt    Float
  totalAnnualCost       Float
  updatedAt             DateTime

  @@index([state])
}

model User {
  id          String       @id
  email       String       @unique
  createdAt   DateTime     @default(now())
  companyName String?
  Assessment  Assessment[]
}

model cost_modifiers {
  modifier_id    Int              @id @default(autoincrement())
  modifier_name  String           @db.VarChar(100)
  modifier_pct   Decimal          @db.Decimal(5, 2)
  description    String?
  active         Boolean?         @default(true)
  role_modifiers role_modifiers[]
}

model role_cost_tiers {
  tier_id              Int       @id @default(autoincrement())
  role_id              Int
  min_headcount        Int
  max_headcount        Int
  blended_cost_ppm_usd Decimal   @db.Decimal(10, 2)
  effective_start      DateTime  @default(dbgenerated("CURRENT_DATE")) @db.Date
  effective_end        DateTime? @db.Date
  notes                String?
  roles                roles     @relation(fields: [role_id], references: [role_id], onDelete: Cascade, onUpdate: NoAction)
}

model role_modifiers {
  role_id        Int
  modifier_id    Int
  cost_modifiers cost_modifiers @relation(fields: [modifier_id], references: [modifier_id], onDelete: Cascade, onUpdate: NoAction)
  roles          roles          @relation(fields: [role_id], references: [role_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([role_id, modifier_id])
}

model roles {
  role_id         Int               @id @default(autoincrement())
  category_id     Int
  role_name       String            @db.VarChar(150)
  region          String?           @db.VarChar(50)
  seniority       String?           @db.VarChar(50)
  active          Boolean?          @default(true)
  created_at      DateTime?         @default(now()) @db.Timestamp(6)
  updated_at      DateTime?         @default(now()) @db.Timestamp(6)
  role_cost_tiers role_cost_tiers[]
  role_modifiers  role_modifiers[]
  role_categories role_categories   @relation(fields: [category_id], references: [category_id], onDelete: Cascade, onUpdate: NoAction)
}
